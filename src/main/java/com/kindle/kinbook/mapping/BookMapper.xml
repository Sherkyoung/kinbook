<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.kindle.kinbook.dao.BookMapper">
  <resultMap id="BaseResultMap" type="com.kindle.kinbook.bean.Book">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Oct 20 22:18:39 CST 2015.
    -->
    <id column="id" jdbcType="INTEGER" property="id" />
    <result column="book_name" jdbcType="VARCHAR" property="book_name" />
    <result column="author" jdbcType="VARCHAR" property="author" />
    <result column="publisher" jdbcType="VARCHAR" property="publisher" />
    <result column="publish_date" jdbcType="VARCHAR" property="publish_date" />
    <result column="page" jdbcType="VARCHAR" property="page" />
    <result column="price" jdbcType="VARCHAR" property="price" />
    <result column="isbn" jdbcType="VARCHAR" property="isbn" />
    <result column="rating_num" jdbcType="VARCHAR" property="rating_num" />
    <result column="author_intro" jdbcType="VARCHAR" property="author_intro" />
    <result column="book_intro" jdbcType="VARCHAR" property="book_intro" />
    <result column="category_id" jdbcType="INTEGER" property="category_id" />
    <result column="cover_link" jdbcType="INTEGER" property="cover_link" />
    <result column="douban_link" jdbcType="VARCHAR" property="douban_link" />
    <result column="ebook_link" jdbcType="INTEGER" property="ebook_link" />
  </resultMap>
  <sql id="Base_Column_List">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Oct 20 22:18:39 CST 2015.
    -->
    id, book_name, author, publisher, publish_date, page, price, isbn, rating_num, author_intro, 
    book_intro, category_id, cover_link, douban_link, ebook_link
  </sql>
  <select id="selectByPrimaryKey" parameterType="java.lang.Integer" resultMap="BaseResultMap">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Oct 20 22:18:39 CST 2015.
    -->
    select 
    <include refid="Base_Column_List" />
    from book
    where id = #{id,jdbcType=INTEGER}
  </select>
  <delete id="deleteByPrimaryKey" parameterType="java.lang.Integer">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Oct 20 22:18:39 CST 2015.
    -->
    delete from book
    where id = #{id,jdbcType=INTEGER}
  </delete>
  <insert id="insert" parameterType="com.kindle.kinbook.bean.Book">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Oct 20 22:18:39 CST 2015.
    -->
    insert into book (id, book_name, author, 
      publisher, publish_date, page, 
      price, isbn, rating_num, 
      author_intro, book_intro, category_id, 
      cover_link, douban_link, ebook_link
      )
    values (#{id,jdbcType=INTEGER}, #{book_name,jdbcType=VARCHAR}, #{author,jdbcType=VARCHAR}, 
      #{publisher,jdbcType=VARCHAR}, #{publish_date,jdbcType=VARCHAR}, #{page,jdbcType=VARCHAR}, 
      #{price,jdbcType=VARCHAR}, #{isbn,jdbcType=VARCHAR}, #{rating_num,jdbcType=VARCHAR}, 
      #{author_intro,jdbcType=VARCHAR}, #{book_intro,jdbcType=VARCHAR}, #{category_id,jdbcType=INTEGER}, 
      #{cover_link,jdbcType=INTEGER}, #{douban_link,jdbcType=VARCHAR}, #{ebook_link,jdbcType=INTEGER}
      )
  </insert>
  <insert id="insertSelective" parameterType="com.kindle.kinbook.bean.Book">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Oct 20 22:18:39 CST 2015.
    -->
    insert into book
    <trim prefix="(" suffix=")" suffixOverrides=",">
      <if test="id != null">
        id,
      </if>
      <if test="book_name != null">
        book_name,
      </if>
      <if test="author != null">
        author,
      </if>
      <if test="publisher != null">
        publisher,
      </if>
      <if test="publish_date != null">
        publish_date,
      </if>
      <if test="page != null">
        page,
      </if>
      <if test="price != null">
        price,
      </if>
      <if test="isbn != null">
        isbn,
      </if>
      <if test="rating_num != null">
        rating_num,
      </if>
      <if test="author_intro != null">
        author_intro,
      </if>
      <if test="book_intro != null">
        book_intro,
      </if>
      <if test="category_id != null">
        category_id,
      </if>
      <if test="cover_link != null">
        cover_link,
      </if>
      <if test="douban_link != null">
        douban_link,
      </if>
      <if test="ebook_link != null">
        ebook_link,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides=",">
      <if test="id != null">
        #{id,jdbcType=INTEGER},
      </if>
      <if test="book_name != null">
        #{book_name,jdbcType=VARCHAR},
      </if>
      <if test="author != null">
        #{author,jdbcType=VARCHAR},
      </if>
      <if test="publisher != null">
        #{publisher,jdbcType=VARCHAR},
      </if>
      <if test="publish_date != null">
        #{publish_date,jdbcType=VARCHAR},
      </if>
      <if test="page != null">
        #{page,jdbcType=VARCHAR},
      </if>
      <if test="price != null">
        #{price,jdbcType=VARCHAR},
      </if>
      <if test="isbn != null">
        #{isbn,jdbcType=VARCHAR},
      </if>
      <if test="rating_num != null">
        #{rating_num,jdbcType=VARCHAR},
      </if>
      <if test="author_intro != null">
        #{author_intro,jdbcType=VARCHAR},
      </if>
      <if test="book_intro != null">
        #{book_intro,jdbcType=VARCHAR},
      </if>
      <if test="category_id != null">
        #{category_id,jdbcType=INTEGER},
      </if>
      <if test="cover_link != null">
        #{cover_link,jdbcType=INTEGER},
      </if>
      <if test="douban_link != null">
        #{douban_link,jdbcType=VARCHAR},
      </if>
      <if test="ebook_link != null">
        #{ebook_link,jdbcType=INTEGER},
      </if>
    </trim>
  </insert>
  <update id="updateByPrimaryKeySelective" parameterType="com.kindle.kinbook.bean.Book">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Oct 20 22:18:39 CST 2015.
    -->
    update book
    <set>
      <if test="book_name != null">
        book_name = #{book_name,jdbcType=VARCHAR},
      </if>
      <if test="author != null">
        author = #{author,jdbcType=VARCHAR},
      </if>
      <if test="publisher != null">
        publisher = #{publisher,jdbcType=VARCHAR},
      </if>
      <if test="publish_date != null">
        publish_date = #{publish_date,jdbcType=VARCHAR},
      </if>
      <if test="page != null">
        page = #{page,jdbcType=VARCHAR},
      </if>
      <if test="price != null">
        price = #{price,jdbcType=VARCHAR},
      </if>
      <if test="isbn != null">
        isbn = #{isbn,jdbcType=VARCHAR},
      </if>
      <if test="rating_num != null">
        rating_num = #{rating_num,jdbcType=VARCHAR},
      </if>
      <if test="author_intro != null">
        author_intro = #{author_intro,jdbcType=VARCHAR},
      </if>
      <if test="book_intro != null">
        book_intro = #{book_intro,jdbcType=VARCHAR},
      </if>
      <if test="category_id != null">
        category_id = #{category_id,jdbcType=INTEGER},
      </if>
      <if test="cover_link != null">
        cover_link = #{cover_link,jdbcType=INTEGER},
      </if>
      <if test="douban_link != null">
        douban_link = #{douban_link,jdbcType=VARCHAR},
      </if>
      <if test="ebook_link != null">
        ebook_link = #{ebook_link,jdbcType=INTEGER},
      </if>
    </set>
    where id = #{id,jdbcType=INTEGER}
  </update>
  <update id="updateByPrimaryKey" parameterType="com.kindle.kinbook.bean.Book">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Oct 20 22:18:39 CST 2015.
    -->
    update book
    set book_name = #{book_name,jdbcType=VARCHAR},
      author = #{author,jdbcType=VARCHAR},
      publisher = #{publisher,jdbcType=VARCHAR},
      publish_date = #{publish_date,jdbcType=VARCHAR},
      page = #{page,jdbcType=VARCHAR},
      price = #{price,jdbcType=VARCHAR},
      isbn = #{isbn,jdbcType=VARCHAR},
      rating_num = #{rating_num,jdbcType=VARCHAR},
      author_intro = #{author_intro,jdbcType=VARCHAR},
      book_intro = #{book_intro,jdbcType=VARCHAR},
      category_id = #{category_id,jdbcType=INTEGER},
      cover_link = #{cover_link,jdbcType=INTEGER},
      douban_link = #{douban_link,jdbcType=VARCHAR},
      ebook_link = #{ebook_link,jdbcType=INTEGER}
    where id = #{id,jdbcType=INTEGER}
  </update>
  
  <select id="getBookInfoDetailById" parameterType="int" resultType="com.kindle.kinbook.pojo.BookInfoDetail">
    SELECT b.id,b.book_name,b.author,b.publisher,b.publish_date,b.page,b.price,b.isbn,b.rating_num,b.author_intro,b.book_intro,bc.book_category,bcm.filename AS book_cover_link,b.douban_link,
      efm_azw.realfilename AS azw_filename_real,
      efm_mobi.realfilename AS mobi_filename_real,
      efm_word.realfilename AS word_filename_real,
      efm_html.realfilename AS html_filename_real,
      efm_rtf.realfilename AS rtf_filename_real,
      efm_picture.realfilename AS picture_filename_real,
      efm_pdf.realfilename AS pdf_filename_real,
      efm_zip.realfilename AS zip_filename_real
    FROM book AS b
    LEFT JOIN book_category AS bc ON (b.category_id = bc.id)
    LEFT JOIN book_cover_mapper AS bcm ON (b.cover_link = bcm.id)
    LEFT JOIN ebook_resources AS er ON (b.ebook_link = er.id)
    LEFT JOIN ebook_file_mapper AS efm_mobi ON (er.mobi_format = efm_mobi.id)
    LEFT JOIN ebook_file_mapper AS efm_azw ON (er.azw_format = efm_azw.id)
    LEFT JOIN ebook_file_mapper AS efm_word ON (er.word_format = efm_word.id)
    LEFT JOIN ebook_file_mapper AS efm_html ON (er.html_format = efm_html.id)
    LEFT JOIN ebook_file_mapper AS efm_rtf ON (er.rtf_format = efm_rtf.id)
    LEFT JOIN ebook_file_mapper AS efm_picture ON (er.picture_format = efm_picture.id)
    LEFT JOIN ebook_file_mapper AS efm_pdf ON (er.pdf_format = efm_pdf.id)
    LEFT JOIN ebook_file_mapper AS efm_zip ON (er.zip_format = efm_zip.id)
    WHERE b.id = #{bookId}
  </select>

  <select id="getBookInfoBasicById" parameterType="int" resultType="com.kindle.kinbook.pojo.BookInfoBasic">
    SELECT b.id,b.book_name,b.author,b.publisher,b.publish_date,b.page,b.price,b.isbn,b.rating_num,bc.book_category AS category,bcm.filename AS book_cover
    FROM book AS b
    LEFT JOIN book_category AS bc ON (b.category_id = bc.id)
    LEFT JOIN book_cover_mapper AS bcm ON (b.cover_link = bcm.id)
    WHERE b.id=#{bookId}
  </select>

  <select id="getBasicBookInfoByCategoryAsce" parameterType="com.kindle.kinbook.pojo.QueryConditionItem1" resultType="com.kindle.kinbook.pojo.BookInfoBasic">
    select b.id,b.book_name,b.author,b.publisher,b.publish_date,b.page,b.price,b.isbn,b.rating_num,bc.book_category as category,bcm.filename as book_cover
    from book as b
    left join book_category as bc on (b.category_id = bc.id)
    left join book_cover_mapper as bcm on (b.cover_link = bcm.id)
    where bc.book_category=#{category}
    ORDER BY b.rating_num ASC
    limit #{startIndex},#{length}
  </select>

  <select id="getBasicBookInfoByCategoryDesc" parameterType="com.kindle.kinbook.pojo.QueryConditionItem1" resultType="com.kindle.kinbook.pojo.BookInfoBasic">
    select b.id,b.book_name,b.author,b.publisher,b.publish_date,b.page,b.price,b.isbn,b.rating_num,bc.book_category as category,bcm.filename as book_cover
    from book as b
    left join book_category as bc on (b.category_id = bc.id)
    left join book_cover_mapper as bcm on (b.cover_link = bcm.id)
    where bc.book_category=#{category}
    ORDER BY b.rating_num DESC
    limit #{startIndex},#{length}
  </select>

  <select id="getBasicBookInfoByRatingAsce" parameterType="com.kindle.kinbook.pojo.QueryConditionItem1" resultType="com.kindle.kinbook.pojo.BookInfoBasic">
    select b.id,b.book_name,b.author,b.publisher,b.publish_date,b.page,b.price,b.isbn,b.rating_num,bc.book_category as category,bcm.filename as book_cover
    from book as b
    left join book_category as bc on (b.category_id = bc.id)
    left join book_cover_mapper as bcm on (b.cover_link = bcm.id)
    ORDER BY b.rating_num ASC
    limit #{startIndex},#{length}
  </select>

  <select id="getBasicBookInfoByRatingDesc" parameterType="com.kindle.kinbook.pojo.QueryConditionItem1" resultType="com.kindle.kinbook.pojo.BookInfoBasic">
    select b.id,b.book_name,b.author,b.publisher,b.publish_date,b.page,b.price,b.isbn,b.rating_num,bc.book_category as category,bcm.filename as book_cover
    from book as b
    left join book_category as bc on (b.category_id = bc.id)
    left join book_cover_mapper as bcm on (b.cover_link = bcm.id)
    ORDER BY b.rating_num DESC
    limit #{startIndex},#{length}
  </select>

  <select id="getBasicBookInfoRealtedToAuthorByRatingDesc" parameterType="java.lang.String" resultType="com.kindle.kinbook.pojo.BookInfoBasic">
    SELECT b.id,b.book_name,b.author,b.publisher,b.publish_date,b.page,b.price,b.isbn,b.rating_num,bc.book_category AS category,bcm.filename AS book_cover
    FROM book AS b
    LEFT JOIN book_category AS bc ON (b.category_id = bc.id)
    LEFT JOIN book_cover_mapper AS bcm ON (b.cover_link = bcm.id)
    WHERE author like concat('%',#{author},'%')
    ORDER BY b.rating_num DESC
  </select>
</mapper>